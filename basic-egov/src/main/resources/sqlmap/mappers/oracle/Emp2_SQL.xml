<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Emp2">

	<resultMap id="empMap" type="com.ohhoonim.vo.EmpVo">
		<result property="empno"    column="EMPNO"     />
		<result property="ename"    column="ENAME"     />
		<result property="sal"      column="SAL"       />
		<result property="manager"  column="MANAGER"   />
		<result property="deptno"   column="DEPTNO"    />
		<result property="hiredate" column="HIREDATE"  jdbcType="DATE"/>
		<result property="age"      column="AGE"       />
		<result property="comm"     column="COMM" />
	</resultMap>
	<resultMap id="empDetailMap" type="java.util.Map">
		<result property="empno"    column="EMPNO"     javaType="java.lang.String"/>
		<result property="ename"    column="ENAME"     javaType="string"/>
		<result property="sal"      column="SAL"       javaType="string"/>
		<result property="manager"  column="MANAGER"   javaType="string"/>
		<result property="managerName"  column="MANAGER_NAME"   javaType="string"/>
		<result property="deptno"   column="DEPTNO"    javaType="string"/>
		<result property="dname"   column="DNAME"    javaType="string"/>
		<result property="hiredate" column="HIREDATE"  javaType="string" jdbcType="DATE"/>
		<result property="age"      column="AGE"       javaType="string"/>
		<result property="comm"     column="COMM" 	   javaType="string"/>
	</resultMap>
	
	<sql id="empQuery">
		select
			empno, ename, sal, manager, deptno, hiredate, age, comm
		from emp
	</sql>

	<select id="empList" resultMap="empMap">
		<include refid="empQuery"/>
	</select>
	
	<!--
	<select id="empDetail" resultMap="empMap">
		<include refid="empQuery"/>
		where empno = #{empno}
	</select>
	-->
	<select id="empDetail" resultMap="empDetailMap">
		SELECT 
			E.EMPNO EMPNO
			, E.ENAME ENAME
			, E.SAL SAL
			, E.MANAGER MANAGER
			, (SELECT ENAME FROM EMP WHERE EMPNO = E.MANAGER) MANAGER_NAME
			, E.DEPTNO DEPTNO
			, D.DNAME DNAME
			, E.HIREDATE HIREDATE
 			, E.AGE AGE
 			, E.COMM COMM
		FROM EMP E, DEPT D
		WHERE 
			E.DEPTNO = D.DEPTNO(+)
			AND EMPNO = #{empno}
	</select>
	
	<insert id="empAdd">
		insert into emp (empno, ename, sal, manager, deptno, hiredate, age, comm)
		values (
			 #{empno}
			,#{ename}
			,#{sal}
			,#{manager}
			,#{deptno}
			,#{hiredate}
			,#{age}
			,#{comm}
		)
	</insert>
	
	<delete id="empRemove">
		delete emp
		where empno = #{empno}
	</delete>
	
	<update id="empModify">
		update emp 
		<set>
		<if test="ename !=null"> ename = #{ename}   	    </if>
		<if test="sal !=null"> , sal = #{sal}     			</if>
		<if test="manager!=null"> , manager = #{manager}   	</if>
		<if test="deptno !=null"> , deptno = #{deptno}   	</if>
		<if test="hiredate !=null"> , hiredate = #{hiredate} </if>
		<if test="age !=null"> , age = #{age}    			</if>
		<if test="comm !=null"> , comm = #{comm}   		 	</if>
		</set>                      
		where empno = #{empno}
	</update>
	
	<select id="deptEmpList" resultMap="empMap">
		select empno, ename, deptno
		from emp
		where deptno = #{deptno}
	</select>
	
</mapper>